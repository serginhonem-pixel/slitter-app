from pathlib import Path
path = Path('src/data/demandFocus.jsx')
text = path.read_text(encoding='utf-8')
start_marker = '        <section className="bg-white rounded-3xl border border-slate-200 shadow-lg p-6 space-y-5">'
end_marker = '        </section>\n      </div>'
start = text.index(start_marker)
end = text.index(end_marker, start)
end_full = end + len('        </section>\n')
new_section = """        <section className=\"bg-white rounded-3xl border border-slate-200 shadow-lg p-6 space-y-6\">\n          <div className=\"flex flex-col gap-3 md:flex-row md:items-center md:justify-between\">\n            <div>\n              <h2 className=\"text-xl font-semibold\">Produtos &amp; BOM</h2>\n              <p className=\"text-xs text-slate-500\">Controle as quantidades e veja o resumo consolidado em bobinas e categorias.</p>\n            </div>\n            <div className=\"flex flex-wrap gap-3 items-center\">\n              <label className=\"flex items-center gap-2 text-xs font-semibold text-slate-500\">\n                <input\n                  type=\"checkbox\"\n                  checked={mostrarSelecionados}\n                  onChange={(e) => setMostrarSelecionados(e.target.checked)}\n                  className=\"accent-indigo-600\"\n                />\n                Mostrar so selecionados\n              </label>\n              <div className=\"flex gap-1 rounded-full bg-slate-100 p-1\">\n                {[\n                  { key: 'produtos', label: 'Tabela de produtos' },\n                  { key: 'bom', label: 'BOM consolidado' },\n                ].map((mode) => (\n                  <button\n                    key={mode.key}\n                    type=\"button\"\n                    onClick={() => setViewMode(mode.key)}\n                    className={`px-3 py-1 rounded-full text-xs font-semibold transition ${viewMode === mode.key ? 'bg-slate-900 text-white' : 'text-slate-500 hover:text-slate-900'}`}\n                  >\n                    {mode.label}\n                  </button>\n                ))}\n              </div>\n            </div>\n          </div>\n          <div className=\"overflow-x-auto\">\n            <input\n              ref={carteiraRef}\n              type=\"file\"\n              accept=\".csv,.txt,.xlsx,.xls\"\n              onChange={(e) => handleUpload(e.target.files?.[0])}\n              className=\"hidden\"\n            />\n            {viewMode === 'produtos' ? (\n              <table className=\"min-w-full text-left border-collapse\">\n                <thead>\n                  <tr className=\"text-xs uppercase tracking-wider text-slate-400 border-b border-slate-100\">\n                    <th className=\"p-3\">Produto</th>\n                    <th className=\"p-3\">Descricao</th>\n                    <th className=\"p-3\">Categoria</th>\n                    <th className=\"p-3 text-right\">Qtd</th>\n                    <th className=\"p-3 text-right\">Consumo (kg)</th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-slate-50\">\n                  {produtosVisiveis.length === 0 && (\n                    <tr>\n                      <td colSpan={5} className=\"p-6 text-center text-sm text-slate-400\">\n                        Nenhum produto: suba a carteira para visualizar o BOM.\n                      </td>\n                    </tr>\n                  )}\n                  {produtosVisiveis.slice(0, 200).map((item) => (\n                    <tr key={item.produto} className=\"hover:bg-slate-50 transition-colors\">\n                      <td className=\"p-3 font-mono text-slate-700\">{item.produto}</td>\n                      <td className=\"p-3 text-sm text-slate-700\">{item.desc}</td>\n                      <td className=\"p-3\">\n                        <input\n                          list=\"categoria-options\"\n                          value={categoriaOverrides[item.produto] ?? item.categoriaKey ?? ''}\n                          onChange={(e) => handleCategoriaChange(item.produto, e.target.value)}\n                          className=\"w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm font-semibold text-slate-800 outline-none focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 transition\"\n                          placeholder=\"Sem categoria\"\n                        />\n                      </td>\n                      <td className=\"p-3 text-right\">\n                        <input\n                          type=\"number\"\n                          min=\"0\"\n                          step=\"1\"\n                          value={qtdPorProduto[item.produto] ?? ''}\n                          onChange={(e) => setQtdPorProduto((prev) => ({ ...prev, [item.produto]: parseQty(e.target.value) }))}\n                          className=\"w-24 text-right font-mono text-slate-800 bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 transition\"\n                        />\n                      </td>\n                      <td className=\"p-3 text-right font-mono text-slate-800\">{fmtKg(item.totalKg || 0)}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            ) : (\n              <div className=\"space-y-6\">\n                {bomSummary.selected.length === 0 ? (\n                  <div className=\"rounded-2xl border border-slate-100 bg-slate-50 p-6 text-sm text-slate-500\">\n                    Escolha produtos com quantidade positiva para gerar o BOM consolidado.\n                  </div>\n                ) : (\n                  <div className=\"space-y-6\">\n                    <div className=\"grid gap-6 md:grid-cols-2\">\n                      <div className=\"rounded-2xl border border-slate-100 bg-slate-50 p-4 shadow-sm\">\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <p className=\"text-xs uppercase tracking-wide text-slate-500\">Bobinas</p>\n                            <p className=\"text-sm text-slate-400\">Consumo por codigo</p>\n                          </div>\n                          <span className=\"text-xs font-semibold text-slate-600\">{fmtKg(bomSummary.totalKg)} kg totais</span>\n                        </div>\n                        <div className=\"mt-4 overflow-x-auto\">\n                          <table className=\"min-w-full text-left border-collapse\">\n                            <thead>\n                              <tr className=\"text-[10px] uppercase tracking-wider text-slate-400 border-b border-slate-100\">\n                                <th className=\"p-2 text-left\">Bobina</th>\n                                <th className=\"p-2 text-left\">Descricao</th>\n                                <th className=\"p-2 text-right\">Consumo (kg)</th>\n                                <th className=\"p-2 text-right\">Bobinas (un)</th>\n                              </tr>\n                            </thead>\n                            <tbody className=\"divide-y divide-slate-100\">\n                              {bomSummary.bobinasAgg.map((bobina) => {\n                                const weight = bobina.totalKg || 0;\n                                const coilsNeeded = Math.ceil(weight / 1000);\n                                return (\n                                  <tr key={bobina.cod} className=\"text-sm text-slate-700\">\n                                    <td className=\"p-2 font-mono text-slate-700\">{bobina.cod}</td>\n                                    <td className=\"p-2\">{bobina.desc}</td>\n                                    <td className=\"p-2 text-right font-mono\">{fmtKg(weight)} kg</td>\n                                    <td className=\"p-2 text-right font-mono\">{fmtNum(coilsNeeded)} un</td>\n                                  </tr>\n                                );\n                              })}\n                            </tbody>\n                          </table>\n                        </div>\n                      </div>\n                      <div className=\"rounded-2xl border border-slate-100 bg-slate-50 p-4 shadow-sm\">\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <p className=\"text-xs uppercase tracking-wide text-slate-500\">Categorias</p>\n                            <p className=\"text-sm text-slate-400\">Resumo agregado</p>\n                          </div>\n                          <span className=\"text-xs font-semibold text-slate-600\">{fmtNum(bomSummary.categoriasAgg.length)} grupos</span>\n                        </div>\n                        <div className=\"mt-4 overflow-x-auto\">\n                          <table className=\"min-w-full text-left border-collapse\">\n                            <thead>\n                              <tr className=\"text-[10px] uppercase tracking-wider text-slate-400 border-b border-slate-100\">\n                                <th className=\"p-2 text-left\">Categoria</th>\n                                <th className=\"p-2 text-right\">Consumo (kg)</th>\n                                <th className=\"p-2 text-right\">Produtos</th>\n                              </tr>\n                            </thead>\n                            <tbody className=\"divide-y divide-slate-100\">\n                              {bomSummary.categoriasAgg.map((category) => (\n                                <tr key={category.categoriaKey} className=\"text-sm text-slate-700\">\n                                  <td className=\"p-2\">{category.categoriaKey}</td>\n                                  <td className=\"p-2 text-right font-mono\">{fmtKg(category.totalKg || 0)} kg</td>\n                                  <td className=\"p-2 text-right\">{fmtNum(category.products)}</td>\n                                </tr>\n                              ))}\n                            </tbody>\n                          </table>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n          <datalist id=\"categoria-options\">\n            {categoriaOptions.map((value) => (\n              <option key={value} value={value} />\n            ))}\n          </datalist>\n        </section>"""
new_text = text[:start] + new_section + text[end_full:]
path.write_text(new_text, encoding='utf-8')

Voc√™ √© um UI/UX designer s√™nior especializado em dashboards industriais com tema escuro.

Vou colar abaixo o c√≥digo JSX de um componente React chamado `renderReports`. Ele √© a tela de RELAT√ìRIOS de um sistema de PCP / controle de produ√ß√£o de uma empresa de a√ßo, com foco em bobinas, corte slitter, produ√ß√£o de perfis e expedi√ß√£o.

O que esse componente faz hoje (use isso como briefing):
- Possui 3 abas principais:
  1) GLOBAL: vis√£o geral com cards de indicadores (Entrada MP, Consumo Slitter, Produ√ß√£o PA, Expedi√ß√£o PA) e uma tabela de ‚ÄúLinha do Tempo Global‚Äù agrupando os eventos do dia.
  2) MP_KARDEX: extrato de mat√©ria-prima (Kardex de bobinas), com bot√µes para exportar PDF, detalhado e saldos, e uma tabela com c√≥digo, descri√ß√£o, largura, saldo anterior, entradas, sa√≠das, saldo atual.
  3) PROD_SUMMARY: resumo de produ√ß√£o por produto (quantidade, peso, sucata) com bot√£o de exportar Excel.
- Acima das abas existe uma √°rea de FILTROS: data in√≠cio, data fim e campo de busca.
- A interface usa tema dark (tons de cinza, azul, roxo, esmeralda etc.) e Tailwind-like utility classes.
- √â um painel voltado para um coordenador de PCP monitorar fluxo de a√ßo, consumo e produ√ß√£o.

TAREFA:
1. Projete uma vers√£o MELHORADA dessa tela de relat√≥rios, mantendo o mesmo conte√∫do e as mesmas se√ß√µes (filtros, abas, cards de indicadores, tabelas), mas:
   - Deixe o layout mais limpo, organizado e leg√≠vel.
   - Melhore a hierarquia visual (o que deve chamar mais aten√ß√£o: filtros, KPIs, alertas).
   - Destaque os n√∫meros mais importantes (rupturas, totais, saldos).
   - Organize melhor os espa√ßos, margens, alinhamentos e divis√µes.
   - Mantenha o tema dark, moderno, industrial/tech (algo que combine com ch√£o de f√°brica de a√ßo).
   - Use tipografia clara, com pesos diferentes para t√≠tulos, labels, n√∫meros e subt√≠tulos.
   - Pense em estados de ‚Äúsem dados‚Äù, rolagem das tabelas e responsividade (desktop principal, mas que funcione em telas menores).

2. Na sa√≠da, descreva APENAS o design visual para ser usado como refer√™ncia de UI (n√£o precisa devolver c√≥digo). Estruture sua resposta assim:
   - Resumo do conceito visual da tela.
   - Layout geral (como ficam distribu√≠dos filtros, abas, cards e tabelas).
   - Estilo visual (cores, tipografia, √≠cones, bordas, sombras).
   - Melhorias espec√≠ficas para:
       a) √°rea de filtros (In√≠cio, Fim, Buscar‚Ä¶)
       b) cart√µes de indicadores da ABA GLOBAL
       c) tabela ‚ÄúLinha do Tempo Global‚Äù
       d) se√ß√£o ‚ÄúExtrato MP‚Äù (t√≠tulo, bot√µes PDF/Excel, tabela)
       e) se√ß√£o ‚ÄúResumo Produ√ß√£o‚Äù
   - Sugest√µes de microintera√ß√µes (hover em linhas, estados de sele√ß√£o de abas, tooltips nos n√∫meros, badges de alerta etc.).

3. Inspire-se em dashboards de dados industriais / supply chain / manufatura avan√ßada, mantendo uma est√©tica s√≥lida e s√©ria, sem ficar ‚Äúcolorido demais‚Äù.

A seguir est√° o c√≥digo atual APENAS para voc√™ entender a estrutura e o conte√∫do (N√ÉO precisa reescrever o c√≥digo, use s√≥ como refer√™ncia de informa√ß√£o e layout l√≥gico):




const renderReports = () => {
  // =================================================================================
  // 1. UTILIT√ÅRIOS E SEGURAN√áA
  // =================================================================================
  const safeNum = (val) => {
    const n = parseFloat(val);
    return isNaN(n) ? 0 : n;
  };

  const normalizeCode = (v) => String(v ?? '').trim();

  const isValidDate = (d) =>
    d && typeof d === 'string' && (d.includes('/') || d.includes('-'));

  const toISODate = (d) => {
    if (!isValidDate(d)) return '0000-00-00';
    if (d.includes('/')) return d.split('/').reverse().join('-');
    return d;
  };

  const getTimestamp = (d) => {
    if (!isValidDate(d)) return 0;
    const iso = d.includes('/') ? d.split('/').reverse().join('-') : d;
    return new Date(`${iso}T12:00:00`).getTime();
  };

  const getTypeColor = (type) => {
    if (type === 'ENTRADA MP') return 'text-blue-400';
    if (type === 'CORTE') return 'text-purple-400';
    if (type === 'PRODU√á√ÉO') return 'text-emerald-400';
    return 'text-amber-400';
  };

  // chave padr√£o de MP: c√≥digo + largura (quando n√£o usamos id)
  // üîπ SEM ID: 1 chave = 1 (c√≥digo + largura)
const makeKeyFromMother = (m) => {
  const code = normalizeCode(m?.code) || 'S/ COD';
  const w = safeNum(m?.width);
  return `${code}|${w || 0}`;
};

const makeKeyFromCut = (c, safeMother) => {
  const code = normalizeCode(c?.motherCode) || 'S/ COD';
  const inputWeight = safeNum(c?.inputWeight); // peso consumido no corte

  const candidates = safeMother.filter(
    (m) => normalizeCode(m.code) === code
  );

  // 1) tenta usar a largura que veio no log de corte
  let width = safeNum(c?.motherWidth) || safeNum(c?.width) || 0;

  const hasMotherWithThisWidth =
    width > 0 &&
    candidates.some((m) => safeNum(m.width) === width);

  // Se a largura que veio NO CORTE n√£o existir em nenhuma bobina,
  // considera que ela √© inv√°lida e vamos tentar outro crit√©rio.
  if (!hasMotherWithThisWidth) {
    width = 0;
  }

  // 2) Se ainda n√£o temos largura v√°lida, tenta casar pelo PESO DO LOTE
  if (!width && inputWeight > 0) {
    // compara com peso original ou peso cheio da bobina
    const byExactWeight = candidates.filter((m) => {
      const wMother =
        safeNum(m.originalWeight) || safeNum(m.weight);
      // toler√¢ncia pequena pra evitar problema de casa decimal
      return Math.abs(wMother - inputWeight) < 0.001;
    });

    if (byExactWeight.length === 1) {
      width = safeNum(byExactWeight[0].width);
    }
  }

  // 3) Se mesmo assim ainda n√£o rolou, volta pro fallback antigo:
  //    se s√≥ tiver UMA largura poss√≠vel nesse c√≥digo, usa ela.
  if (!width) {
    const uniqueWidths = [
      ...new Set(
        candidates.map((m) => safeNum(m.width)).filter((w) => w > 0)
      ),
    ];
    if (uniqueWidths.length === 1) {
      width = uniqueWidths[0];
    } else {
      // aqui n√£o tem jeito: amb√≠guo mesmo
      width = 0;
    }
  }

  return `${code}|${width || 0}`;
};



const handleGlobalDetail = (group) => {
  // group = { date, isoDate, type, events, totalQty, totalWeight }
  setSelectedGlobalGroup(group);
};



  // Arrays seguros
  const safeMother = Array.isArray(motherCoils) ? motherCoils : [];
  const safeCutting = Array.isArray(cuttingLogs) ? cuttingLogs : [];
  const safeProd = Array.isArray(productionLogs) ? productionLogs : [];
  const safeShipping = Array.isArray(shippingLogs) ? shippingLogs : [];

  // =================================================================================
  // 2. EXTRATO MP (KARDEX)
  // =================================================================================

  // A. Estoque real (saldo f√≠sico hoje)
  const realStockMap = {};
  safeMother.forEach((m) => {
    if (m.status !== 'stock') return;
    const key = makeKeyFromMother(m);
    if (!realStockMap[key]) realStockMap[key] = 0;
    realStockMap[key] += safeNum(m.remainingWeight) || safeNum(m.weight);
  });

  // B. Cat√°logo por c√≥digo
  const catalogByCode = (motherCatalog || []).reduce((acc, item) => {
    const code = normalizeCode(item.code);
    if (code) acc[code] = item;
    return acc;
  }, {});

  // C. Movimenta√ß√µes por chave
  const movementsMap = {};

  // C1. Entradas
  safeMother.forEach((m) => {
    if (!m.date) return;
    const d = toISODate(m.date);
    if (d < reportStartDate || d > reportEndDate) return;

    const key = makeKeyFromMother(m);
    if (!movementsMap[key]) movementsMap[key] = { in: 0, out: 0, details: [] };

    let w = safeNum(m.originalWeight);
    if (w === 0) w = safeNum(m.weight);

    const width = safeNum(m.width);

    movementsMap[key].in += w;
    movementsMap[key].details.push({
      date: m.date,
      timestamp: getTimestamp(m.date),
      type: 'ENTRADA',
      weightChange: w,
      width, // guarda largura no movimento
      desc: m.material,
      detail: `NF: ${m.nf || '-'}`,
    });
  });

  // C2. Sa√≠das (corte slitter)
  safeCutting.forEach((c) => {
    if (!c.date) return;
    const d = toISODate(c.date);
    if (d < reportStartDate || d > reportEndDate) return;

    const key = makeKeyFromCut(c, safeMother);
    if (!movementsMap[key]) movementsMap[key] = { in: 0, out: 0, details: [] };

    const w = safeNum(c.inputWeight);

    // largura usada na chave
    let width =
      safeNum(c?.motherWidth) ||
      safeNum(c?.width) ||
      0; // se veio 0 √© porque n√£o temos certeza

    movementsMap[key].out += w;
    movementsMap[key].details.push({
      date: c.date,
      timestamp: getTimestamp(c.date),
      type: 'SA√çDA',
      weightChange: -w,
      width,
      desc: c.motherMaterial,
      detail: c.generatedItems,
    });
  });

  // D. Consolida√ß√£o
  const mpSummaryList = [];
  const allKeys = new Set([
    ...Object.keys(movementsMap),
    ...Object.keys(realStockMap),
  ]);

  allKeys.forEach((key) => {
  const stock = realStockMap[key] || 0;
  const mov = movementsMap[key] || { in: 0, out: 0, details: [] };

  if (stock === 0 && mov.in === 0 && mov.out === 0) return;

  const calculatedInitial = stock - mov.in + mov.out;

  // key = "CODIGO|LARGURA"
  const [rawCode, rawWidth = '0'] = key.split('|');
  const code = normalizeCode(rawCode) || 'S/ COD';
  let width = safeNum(rawWidth) || 0;

  // üîπ FALLBACK: se width veio 0, tenta achar em movimentos ou bobinas
  if (!width || width === 0) {
    const movWidth = mov.details.find((d) => safeNum(d.width) > 0);
    if (movWidth) {
      width = safeNum(movWidth.width);
    } else {
      const anyCoil = safeMother.find(
        (m) => normalizeCode(m.code) === code && safeNum(m.width) > 0
      );
      if (anyCoil) width = safeNum(anyCoil.width);
    }
  }

  const catalogItem = catalogByCode[code];
  const originalCoil = safeMother.find(
    (m) =>
      normalizeCode(m.code) === code &&
      (!width || safeNum(m.width) === width)
  );
  const histDesc = mov.details[0]?.desc;

  const description =
    catalogItem?.description ||
    originalCoil?.material ||
    histDesc ||
    'Item';

  mpSummaryList.push({
    key,
    code,
    width: width || null,
    desc: description,
    initialBalance: calculatedInitial,
    periodIn: mov.in,
    periodOut: mov.out,
    finalBalance: stock,
    movements: mov.details.sort((a, b) => a.timestamp - b.timestamp),
  });
});

  mpSummaryList.sort((a, b) => {
  const c = String(a.code).localeCompare(String(b.code));
  if (c !== 0) return c;
  return (a.width || 0) - (b.width || 0);
});


  // =================================================================================
  // 3. VIS√ÉO GERAL (GLOBAL)
  // =================================================================================
    const rawGlobalEvents = [];

  // ENTRADA MP
  safeMother.forEach((m) =>
    rawGlobalEvents.push({
      rawDate: m.date,
      type: 'ENTRADA MP',
      id: m.code || '?',
      desc: m.material || '-',
      qty: 1,
      weight: safeNum(m.originalWeight) || safeNum(m.weight),
    })
  );

  // CORTE SLITTER
  // CORTE ‚Äì usado na LINHA DO TEMPO GLOBAL e no modal "Cortes Slitter"
safeCutting.forEach((c) => {
  rawGlobalEvents.push({
    rawDate: c.date,
    type: 'CORTE',
    id: c.motherCode || '?',

    // üëá Prioridade de descri√ß√£o:
    // 1) generatedItems  -> produtos cortados (bobina 2 / telha)
    // 2) motherMaterial  -> descri√ß√£o da bobina m√£e
    // 3) fallback gen√©rico
    desc:
      c.generatedItems ||
      c.motherMaterial ||
      'Corte Slitter',

    qty: safeNum(c.outputCount) || 1,
    weight: safeNum(c.inputWeight),
  });
});


  // PRODU√á√ÉO PA
  safeProd.forEach((p) =>
    rawGlobalEvents.push({
      rawDate: p.date,
      type: 'PRODU√á√ÉO',
      id: p.productCode || '?',
      desc: p.productName || '-',
      qty: safeNum(p.pieces),
      weight: safeNum(p.weight),
    })  
  );

  // EXPEDI√á√ÉO PA
  safeShipping.forEach((s) =>
    rawGlobalEvents.push({
      rawDate: s.date,
      type: 'EXPEDI√á√ÉO',
      id: s.productCode || '?',
      desc: s.productName || '-',
      qty: safeNum(s.quantity),
      weight: 0,
    })
  );

  // ---- AGRUPAMENTO POR DIA + TIPO ----
  const stats = { entradaKg: 0, corteKg: 0, prodPcs: 0, expPcs: 0 };
  const globalGroupsMap = {};

  rawGlobalEvents.forEach((e) => {
    if (!e.rawDate) return;

    const iso = toISODate(e.rawDate);
    if (iso < reportStartDate || iso > reportEndDate) return;

    if (reportSearch) {
      const term = reportSearch.toLowerCase();
      const text = (
        String(e.id) +
        String(e.desc) +
        String(e.type)
      ).toLowerCase();
      if (!text.includes(term)) return;
    }

    const key = `${iso}|${e.type}`;

    if (!globalGroupsMap[key]) {
      globalGroupsMap[key] = {
        date: e.rawDate,
        isoDate: iso,
        type: e.type,
        events: [],
        totalQty: 0,
        totalWeight: 0,
      };
    }

    const group = globalGroupsMap[key];
    group.events.push(e);
    group.totalQty += e.qty;
    group.totalWeight += e.weight;

    if (e.type === 'ENTRADA MP') stats.entradaKg += e.weight;
    if (e.type === 'CORTE') stats.corteKg += e.weight;
    if (e.type === 'PRODU√á√ÉO') stats.prodPcs += e.qty;
    if (e.type === 'EXPEDI√á√ÉO') stats.expPcs += e.qty;
  });

  // Lista final, agrupada e ORDENADA (mais recente primeiro)
  const globalTimeline = Object.values(globalGroupsMap).sort(
    (a, b) => b.isoDate.localeCompare(a.isoDate)
  );


  // =================================================================================
  // 4. RESUMO PRODU√á√ÉO
  // =================================================================================
  const prodByProductMap = {};

  safeProd.forEach((lot) => {
    if (!lot.date) return;
    const d = toISODate(lot.date);
    if (d < reportStartDate || d > reportEndDate) return;

    if (reportSearch) {
      const term = reportSearch.toLowerCase();
      const text = (
        String(lot.productCode) + String(lot.productName)
      ).toLowerCase();
      if (!text.includes(term)) return;
    }

    const code = lot.productCode || 'S/ COD';
    if (!prodByProductMap[code]) {
      prodByProductMap[code] = {
        code,
        name: lot.productName,
        totalQty: 0,
        totalWeight: 0,
        totalScrap: 0,
      };
    }
    prodByProductMap[code].totalQty += safeNum(lot.pieces);
    prodByProductMap[code].totalWeight += safeNum(lot.weight);
    prodByProductMap[code].totalScrap += safeNum(lot.scrap);
  });

  const prodSummaryList = Object.values(prodByProductMap).sort((a, b) =>
    String(a.name).localeCompare(String(b.name))
  );

  // =================================================================================
  // 5. RENDERIZA√á√ÉO
  // =================================================================================
  return (
    <div className="space-y-6 h-full flex flex-col">
      {/* ABAS */}
      <div className="flex gap-2 border-b border-gray-700 pb-2 overflow-x-auto">
        <button
          onClick={() => setReportViewMode('GLOBAL')}
          className={`px-4 py-3 font-bold text-xs md:text-sm rounded-t-lg transition-colors ${
            reportViewMode === 'GLOBAL'
              ? 'bg-blue-600 text-white'
              : 'bg-gray-800 text-gray-400 hover:text-white'
          }`}
        >
          Vis√£o Geral
        </button>
        <button
          onClick={() => setReportViewMode('MP_KARDEX')}
          className={`px-4 py-3 font-bold text-xs md:text-sm rounded-t-lg transition-colors ${
            reportViewMode === 'MP_KARDEX'
              ? 'bg-emerald-600 text-white'
              : 'bg-gray-800 text-gray-400 hover:text-white'
          }`}
        >
          Extrato MP
        </button>
        <button
          onClick={() => setReportViewMode('PROD_SUMMARY')}
          className={`px-4 py-3 font-bold text-xs md:text-sm rounded-t-lg transition-colors ${
            reportViewMode === 'PROD_SUMMARY'
              ? 'bg-purple-600 text-white'
              : 'bg-gray-800 text-gray-400 hover:text-white'
          }`}
        >
          Resumo Produ√ß√£o
        </button>
      </div>

      {/* FILTROS */}
      <Card>
        <div className="flex flex-col md:flex-row gap-4 items-end">
          <div className="flex gap-2 flex-1">
            <div className="flex-1">
              <label className="block text-xs text-gray-500 mb-1">In√≠cio</label>
              <input
                type="date"
                value={reportStartDate}
                onChange={(e) => setReportStartDate(e.target.value)}
                className="w-full bg-gray-900 border border-gray-700 rounded p-2 text-white outline-none focus:border-blue-500"
              />
            </div>
            <div className="flex-1">
              <label className="block text-xs text-gray-500 mb-1">Fim</label>
              <input
                type="date"
                value={reportEndDate}
                onChange={(e) => setReportEndDate(e.target.value)}
                className="w-full bg-gray-900 border border-gray-700 rounded p-2 text-white outline-none focus:border-blue-500"
              />
            </div>
          </div>
          <div className="w-full md:w-1/3">
            <input
              type="text"
              placeholder="Buscar..."
              value={reportSearch}
              onChange={(e) => setReportSearch(e.target.value)}
              className="w-full bg-gray-900 border border-gray-700 rounded p-2 text-white outline-none focus:border-blue-500"
            />
          </div>
        </div>
      </Card>

      {/* ABA 1: GLOBAL */}
      {reportViewMode === 'GLOBAL' && (
        <>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 shrink-0">
            <Card className="border-l-4 border-blue-500 bg-gray-800 p-4">
              <p className="text-gray-400 text-[10px] font-bold uppercase">
                Entrada MP
              </p>
              <div className="flex items-end gap-1 mt-1">
                <span className="text-xl font-bold text-white">
                  {stats.entradaKg.toLocaleString('pt-BR')}
                </span>
                <span className="text-xs text-blue-400 mb-1">kg</span>
              </div>
            </Card>
            <Card className="border-l-4 border-purple-500 bg-gray-800 p-4">
              <p className="text-gray-400 text-[10px] font-bold uppercase">
                Consumo Slitter
              </p>
              <div className="flex items-end gap-1 mt-1">
                <span className="text-xl font-bold text-white">
                  {stats.corteKg.toLocaleString('pt-BR')}
                </span>
                <span className="text-xs text-purple-400 mb-1">kg</span>
              </div>
            </Card>
            <Card className="border-l-4 border-emerald-500 bg-gray-800 p-4">
              <p className="text-gray-400 text-[10px] font-bold uppercase">
                Produ√ß√£o PA
              </p>
              <div className="flex items-end gap-1 mt-1">
                <span className="text-xl font-bold text-white">
                  {stats.prodPcs.toLocaleString('pt-BR')}
                </span>
                <span className="text-xs text-emerald-400 mb-1">p√ßs</span>
              </div>
            </Card>
            <Card className="border-l-4 border-amber-500 bg-gray-800 p-4">
              <p className="text-gray-400 text-[10px] font-bold uppercase">
                Expedi√ß√£o PA
              </p>
              <div className="flex items-end gap-1 mt-1">
                <span className="text-xl font-bold text-white">
                  {stats.expPcs.toLocaleString('pt-BR')}
                </span>
                <span className="text-xs text-amber-400 mb-1">p√ßs</span>
              </div>
            </Card>
          </div>

          <Card className="flex-1 flex flex-col min-h-0 overflow-hidden">
            <div className="flex justify-between items-center mb-4 pb-4 border-b border-gray-700">
              <h3 className="font-bold text-gray-200">
                Linha do Tempo Global
              </h3>
              <Button
                variant="secondary"
                onClick={() => {
                  const data = globalTimeline.map((e) => ({
                    Data: e.rawDate,
                    Tipo: e.type,
                    C√≥digo: e.id,
                    Descri√ß√£o: e.desc,
                    Qtd: e.qty,
                    Peso: e.weight,
                  }));
                  exportToCSV(data, `relatorio_global`);
                }}
                className="h-8 text-xs"
              >
                <Download size={14} /> Excel
              </Button>
            </div>
            <div className="flex-1 overflow-auto custom-scrollbar-dark">
              <table className="w-full text-sm text-left text-gray-300">
                <thead className="bg-gray-900 text-gray-400 sticky top-0 z-10">
                  <tr>
                    <th className="p-3">Data</th>
                    <th className="p-3 text-center">Tipo</th>
                    <th className="p-3">Descri√ß√£o</th>
                    <th className="p-3 text-right">Qtd</th>
                    <th className="p-3 text-right">Peso</th>
                    <th className="p-3 text-center">Ver</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-700">
                  {globalTimeline.length === 0 ? (
                    <tr>
                      <td colSpan="6" className="p-8 text-center text-gray-500">
                        Nenhum registro no per√≠odo.
                      </td>
                    </tr>
                  ) : (
                    globalTimeline.map((g, idx) => (
                      <tr
                        key={idx}
                        className="hover:bg-gray-700/50 transition-colors"
                      >
                        <td className="p-3 text-xs text-gray-400 font-mono">
                          {g.date}
                        </td>
                        <td
                          className={`p-3 font-bold text-xs ${getTypeColor(
                            g.type
                          )}`}
                        >
                          {g.type}
                        </td>
                        <td className="p-3 text-white">
                          {g.type === 'ENTRADA MP' &&
                            `Entradas de MP (${g.events.length} registro${
                              g.events.length !== 1 ? 's' : ''
                            })`}
                          {g.type === 'CORTE' &&
                            `Cortes Slitter (${g.events.length} registro${
                              g.events.length !== 1 ? 's' : ''
                            })`}
                          {g.type === 'PRODU√á√ÉO' &&
                            `Produ√ß√µes de PA (${g.events.length} registro${
                              g.events.length !== 1 ? 's' : ''
                            })`}
                          {g.type === 'EXPEDI√á√ÉO' &&
                            `Expedi√ß√µes de PA (${g.events.length} registro${
                              g.events.length !== 1 ? 's' : ''
                            })`}
                        </td>
                        <td className="p-3 text-right text-gray-300">
                          {g.totalQty}
                        </td>
                        <td className="p-3 text-right font-mono text-gray-300">
                          {g.totalWeight.toLocaleString('pt-BR', {
                            minimumFractionDigits: 1,
                            maximumFractionDigits: 1,
                          })}
                        </td>
                        <td className="p-3 text-center">
                          <button
                            onClick={() => handleGlobalDetail(g)}
                            className="px-3 py-1 bg-gray-700 hover:bg-white hover:text-black rounded text-xs transition-colors flex items-center gap-2 mx-auto"
                          >
                            <Eye size={14} />
                          </button>
                        </td>
                      </tr>
                    ))
                  )}

                </tbody>
              </table>
            </div>
          </Card>
        </>
      )}

      {/* ABA 2: EXTRATO MP */}
      {reportViewMode === 'MP_KARDEX' && (
        <Card className="flex-1 flex flex-col min-h-0 overflow-hidden border-t-4 border-emerald-600">
          <div className="flex justify-between items-center mb-4 pb-4 border-b border-gray-700 p-4 bg-emerald-900/10 -mt-6 -mx-6">
            <div>
              <h3 className="font-bold text-xl text-emerald-100">
                Extrato MP
              </h3>
              <p className="text-sm text-emerald-300/70">Auditoria de Estoque</p>
            </div>
            <div className="flex gap-2">
              <Button
                onClick={() =>
                  handleGenerateMPReportPDF(
                    mpSummaryList,
                    reportStartDate,
                    reportEndDate
                  )
                }
                className="h-9 bg-rose-600 text-white hover:bg-rose-500"
              >
                <FileText size={14} /> PDF
              </Button>
              <Button
                onClick={() => {
                  const analyticalData = [];
                  mpSummaryList.forEach((item) => {
                    item.movements.forEach((mov) => {
                      analyticalData.push({
                        C√≥digo: item.code,
                        Descri√ß√£o: item.desc,
                        'Largura (mm)': item.width ?? '',
                        Data: mov.date,
                        Tipo: mov.type,
                        'Detalhe/NF': mov.detail,
                        'Entrada (kg)':
                          mov.type === 'ENTRADA' ? mov.weightChange : 0,
                        'Sa√≠da (kg)':
                          mov.type !== 'ENTRADA'
                            ? Math.abs(mov.weightChange)
                            : 0,
                      });
                    });
                  });
                  exportToCSV(analyticalData, `relatorio_analitico_mp`);
                }}
                className="h-9 bg-blue-600 text-white hover:bg-blue-500"
              >
                <Download size={14} /> Detalhado
              </Button>
              <Button
                onClick={() => {
                  const data = mpSummaryList.map((i) => ({
                    C√≥digo: i.code,
                    Descri√ß√£o: i.desc,
                    'Largura (mm)': i.width ?? '',
                    'Saldo Anterior (kg)': i.initialBalance,
                    'Entradas (kg)': i.periodIn,
                    'Sa√≠das (kg)': i.periodOut,
                    'Saldo Atual (kg)': i.finalBalance,
                  }));
                  exportToCSV(data, `extrato_mp_saldos`);
                }}
                className="h-9 bg-emerald-600 text-white"
              >
                <Download size={14} /> Saldos
              </Button>
            </div>
          </div>
          
          <RawMaterialRequirement
        motherCoils={motherCoils}
        childCoils={childCoils}
        productCatalog={productCatalog}
        motherCatalog={INITIAL_MOTHER_CATALOG}
      />



          <div className="flex-1 overflow-auto custom-scrollbar-dark px-4 pb-4">
            <table className="w-full text-sm text-left text-gray-300">
              <thead className="bg-gray-800 text-gray-400 sticky top-0">
                <tr>
                  <th className="p-3">C√≥digo</th>
                  <th className="p-3">Descri√ß√£o</th>
                  <th className="p-3 text-right">Largura (mm)</th>
                  <th className="p-3 text-right text-gray-400 bg-gray-900/50">
                    Saldo Ant.
                  </th>
                  <th className="p-3 text-right text-emerald-400">Entradas</th>
                  <th className="p-3 text-right text-red-400">Sa√≠das</th>
                  <th className="p-3 text-right text-white font-bold bg-blue-900/40 border-l border-blue-700">
                    Saldo Atual
                  </th>
                  <th className="p-3 text-center">A√ß√£o</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-700">
                {mpSummaryList
                  .filter((i) => {
                    if (!reportSearch) return true;
                    const term = reportSearch.toLowerCase();
                    return (
                      i.code.toLowerCase().includes(term) ||
                      String(i.desc || '')
                        .toLowerCase()
                        .includes(term) ||
                      (i.width != null &&
                        String(i.width).toLowerCase().includes(term))
                    );
                  })
                  .map((row, idx) => (
                    <tr key={idx} className="hover:bg-gray-700/50">
                      <td className="p-3 font-bold text-white">{row.code}</td>
                      <td className="p-3 text-gray-400 truncate max-w-[220px]">
                        {row.desc}
                      </td>
                      <td className="p-3 text-right text-gray-300 font-mono">
                        {row.width != null ? row.width : '-'}
                      </td>
                      <td className="p-3 text-right text-gray-300 font-mono bg-gray-900/30">
                        {row.initialBalance.toLocaleString('pt-BR')}
                      </td>
                      <td className="p-3 text-right text-emerald-400 font-mono">
                        {row.periodIn.toLocaleString('pt-BR')}
                      </td>
                      <td className="p-3 text-right text-red-400 font-mono">
                        {row.periodOut.toLocaleString('pt-BR')}
                      </td>
                      <td className="p-3 text-right font-bold text-white font-mono bg-blue-900/20 border-l border-gray-700">
                        {row.finalBalance.toLocaleString('pt-BR')}
                      </td>
                      <td className="p-3 text-center">
                        <button
                          onClick={() =>
                            setViewingMpDetails({
                              ...row,
                              initialBalance: row.initialBalance,
                            })
                          }
                          className="px-3 py-1 bg-gray-700 hover:bg-white hover:text-black rounded text-xs"
                        >
                          <Eye size={14} />
                        </button>
                      </td>
                    </tr>
                  ))}
              </tbody>
            </table>
          </div>
        </Card>
      )}

      {/* ABA 3: RESUMO PRODU√á√ÉO */}
      {reportViewMode === 'PROD_SUMMARY' && (
        <Card className="flex-1 flex flex-col min-h-0 overflow-hidden border-t-4 border-purple-600">
          <div className="flex justify-between items-center mb-4 pb-4 border-b border-gray-700 p-4 bg-purple-900/10 -mt-6 -mx-6">
            <div>
              <h3 className="font-bold text-xl text-purple-100">
                Resumo Produ√ß√£o
              </h3>
              <p className="text-sm text-purple-300/70">Por Produto</p>
            </div>
            <Button
              onClick={() => {
                const data = prodSummaryList.map((i) => ({
                  Produto: i.name,
                  C√≥digo: i.code,
                  Qtd: i.totalQty,
                  Peso: i.totalWeight,
                  Sucata: i.totalScrap,
                }));
                exportToCSV(data, `resumo_producao`);
              }}
              className="h-9 bg-purple-600 text-white"
            >
              <Download size={14} /> Excel
            </Button>
          </div>
          <div className="flex-1 overflow-auto custom-scrollbar-dark px-4 pb-4">
            <table className="w-full text-sm text-left text-gray-300">
              <thead className="bg-gray-800 text-gray-400 sticky top-0">
                <tr>
                  <th className="p-3">Produto</th>
                  <th className="p-3">C√≥digo</th>
                  <th className="p-3 text-right text-emerald-400">Qtd</th>
                  <th className="p-3 text-right text-blue-400">Peso</th>
                  <th className="p-3 text-right text-red-400">Sucata</th>
                  <th className="p-3 text-center">A√ß√£o</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-700">
                {prodSummaryList.map((row, idx) => (
                  <tr key={idx} className="hover:bg-gray-700/50">
                    <td className="p-3 font-bold text-white text-sm">
                      {row.name}
                    </td>
                    <td className="p-3 text-gray-400 text-xs font-mono">
                      {row.code}
                    </td>
                    <td className="p-3 text-right text-emerald-400 font-bold text-lg">
                      {row.totalQty}
                    </td>
                    <td className="p-3 text-right text-blue-400 font-mono">
                      {row.totalWeight.toFixed(1)} kg
                    </td>
                    <td className="p-3 text-right text-red-400 font-mono">
                      {row.totalScrap.toFixed(1)} kg
                    </td>
                    <td className="p-3 text-center">
                      <button
                        onClick={() => setViewingProdDetails(row)}
                        className="px-3 py-1 bg-gray-700 hover:bg-white hover:text-black rounded text-xs transition-colors flex items-center gap-2 mx-auto"
                      >
                        <Eye size={14} /> Detalhes
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </Card>
      )}
    </div>
  );
};



